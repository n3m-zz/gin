name: Experimento de Energia - PhD Maycon

on:
  push:
    branches: [ main ]
  workflow_dispatch: # Permite rodar manualmente pelo botão no GitHub

jobs:
  energy-experiment:
    runs-on: self-hosted
    steps:
      - name: Checkout do Código
        uses: actions/checkout@v4

      - name: Instalar Dependências de ML
        run: |
          pip install -r requirements.txt
          # Se o seu script de medição precisar de algo extra (ex: pyRAPL)
          pip install py3-rapl  

      - name: Executar Medição de Energia
        run: |
          # Rodando o script e salvando a saída em um CSV
          # O sudo aqui funciona sem senha devido à nossa config no Dockerfile
          sudo python3 measure_energy.py --cmd "pytest tests/meu_modelo_ml.py" --output resultados_energia.csv

      - name: Upload dos Resultados
        uses: actions/upload-artifact@v4
        with:
          name: logs-consumo-energetico
          path: resultados_energia.csv